# Dynamic Configuration - Middlewares
# ====================================

http:
  middlewares:
    # Rate Limiting
    rate-limit:
      rateLimit:
        average: 100
        burst: 50
        period: 1s

    # Security Headers
    secure-headers:
      headers:
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        customFrameOptionsValue: "SAMEORIGIN"

    # Compression
    compress:
      compress:
        excludedContentTypes:
          - text/event-stream

    # Retry
    retry:
      retry:
        attempts: 3
        initialInterval: 100ms

    # Circuit Breaker
    circuit-breaker:
      circuitBreaker:
        expression: "NetworkErrorRatio() > 0.30 || ResponseCodeRatio(500, 600, 0, 600) > 0.25"

    # Strip prefix example
    strip-api-prefix:
      stripPrefix:
        prefixes:
          - "/api"

    # Add custom request headers
    # Note: Traefik customRequestHeaders does not support Go template syntax.
    # Use a static marker value or a plugin for dynamic values.
    add-request-id:
      headers:
        customRequestHeaders:
          X-Request-Source: "traefik"

    # Dashboard BasicAuth (프로덕션용)
    # 비밀번호 생성: htpasswd -nB admin
    # docker-compose.yml의 traefik-dashboard 라우터에서 이 미들웨어를 활성화하세요
    # dashboard-auth:
    #   basicAuth:
    #     users:
    #       - "admin:$2y$05$your_hashed_password_here"
